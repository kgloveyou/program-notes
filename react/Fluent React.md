## Fluent React 

## Build Fast, Performant, and Intuitive Web Applications

## 第一章 入门知识

作为补充，我们提到了防抖 (debouncing) 和节流 (throttling) 这两个概念。为了清楚起见，**防抖会延迟函数的执行，直到距离上一次事件触发经过设定时间之后才执行**（例如，等待用户停止输入后再处理输入内容）。**节流则限制函数每隔设定时间间隔最多只运行一次**，确保其不会过于频繁地执行（例如，以设定的间隔处理滚动事件）。这两种技术通过控制函数的执行速率来优化性能。

## 进入React

### 声明式与命令式代码

React提供了对DOM的声明式抽象。我们稍后会在书中更详细地讨论它是如何做到这一点的，但基本上它为我们提供了一种编写代码的方式，表达我们想要看到的内容，同时又负责处理代码如何执行，确保我们的用户界面以安全、可预测和高效的方式创建并运行。

让我们考虑一下我们之前创建的列表应用程序。在React中，我们可以像这样重写它：

注意在返回语句中，我们实际上写的是看起来像HTML的东西：它看起来就像我们想要看到的内容。我想看到一个带有NewItemForm的框和一个列表。咔嚓。如何实现这一点？这是由React来解决的。我们是批处理列表项以一次性添加它们的一部分吗？我们是逐个添加它们，一个接一个吗？React处理了这是如何完成的，而我们仅仅描述了我们想要做的事情。在后续章节中，我们将深入探讨React，并详细探索它在编写时是如何做到这一点的。

那么我们是否依赖于类名来引用HTML元素？我们是否在JavaScript中使用getElementById？不是的。React在幕后为我们创建了唯一的“React元素”，它用于检测更改并进行增量更新，因此我们不需要从用户代码中读取类名和其他标识符，我们无法保证其存在：我们的真相来源仅仅是JavaScript与React。

我们将我们的 MyList 组件导出给 React，React 将其显示在屏幕上，以一种安全、可预测和高效的方式——无需多问。组件的任务只是返回一个描述这个 UI 部分应该是什么样子的描述。它通过使用虚拟 DOM（vDOM）来实现这一点，虚拟 DOM 是对预期 UI 结构的轻量级描述。然后，React 在更新发生后将虚拟 DOM 与更新之前的虚拟 DOM 进行比较，并将其转换为对真实 DOM 的小型、高效的更新，使其与虚拟 DOM 匹配。这就是 React 如何能够更新 DOM。

### 虚拟 DOM

虚拟 DOM 是一个编程概念，它代表了真实 DOM，但作为一个 JavaScript 对象。如果这对现在来说有点太复杂了，不用担心：第三章专门介绍了这个概念，并以更详细的方式进行了解释。目前，重要的是要知道虚拟 DOM 允许开发人员更新 UI 而不直接操作实际的 DOM。React 使用虚拟 DOM 来跟踪组件的更改，并仅在必要时重新渲染组件。这种方法比每次有更改时更新整个 DOM 树更快、更高效。

在 React 中，虚拟 DOM 是实际 DOM 树的轻量级表示。它是一个普通的 JavaScript 对象，描述了 UI 元素的结构和属性。React 创建和更新虚拟 DOM 以匹配实际 DOM 树，对虚拟 DOM 进行的任何更改都将使用一种称为协调的过程应用到实际 DOM 上。

第四章专门介绍了这个概念，但在我们当前的上下文讨论中，让我们简要总结一下，并举几个例子。为了理解虚拟 DOM 的工作原理，让我们回顾一下我们的点赞按钮的例子。我们将创建一个 React 组件，显示一个点赞按钮和点赞的数量。当用户点击按钮时，点赞的数量应该增加一。

下面是我们组件的代码：

```jsx
import React, { useState } from "react";
function LikeButton() {
  const [likes, setLikes] = useState(0);
  function handleLike() {
    setLikes(likes + 1);
  }
  return (
    <div>
      <button onClick={handleLike}>Like</button>
      <p>{likes} Likes</p>
    </div>
  );
}
export default LikeButton;

```

在这段代码中，我们使用了 useState 钩子来创建一个状态变量 likes，它保存着点赞的数量。回顾一下我们可能已经了解的关于 React 的知识，钩子是一种特殊的函数，允许我们在函数组件内部使用 React 的功能，比如状态和生命周期方法。钩子使我们能够重用有状态逻辑而不改变组件层次结构，使得从组件中提取和共享钩子变得容易，甚至可以将其作为独立的开源包与社区共享。

我们还定义了一个名为 handleLike 的函数，当按钮被点击时，它会将 likes 的值增加一。最后，我们使用 JSX 渲染了点赞按钮和点赞数量。

现在，让我们更详细地看一下在这个示例中虚拟 DOM 是如何工作的。当 LikeButton 组件首次被渲染时，React 创建了一个虚拟 DOM 树，它镜像了实际 DOM 树。虚拟 DOM 包含一个包含一个按钮元素和一个 p 元素的 div 元素：

```js
{
  $$typeof: Symbol.for('react.element'),
  type: 'div',
  props: { },
  children: [
    {
      $$typeof: Symbol.for('react.element'),
      type: 'button',
      props: { onClick: handleLike },
      children: ['Like']
    },
    {
      $$typeof: Symbol.for('react.element'),
      type: 'p',
      props: {},
      children: [0, ' Likes']
    }
  ]
}
```

p 元素的 children 属性包含 Likes 状态变量的值，初始设置为零。
当用户点击点赞按钮时，会调用 handleLike 函数，该函数会更新 likes 状态变量。React 然后创建一个反映更新状态的新虚拟 DOM 树：

```js
{
  type: 'div',
    props: { },
  children: [
    {
      type: 'button',
      props: { onClick: handleLike },
      children: ['Like']
    },
    {
      type: 'p',
      props: {},
      children: [1, ' Likes']
    }
  ]
}
```

请注意，虚拟 DOM 树包含与之前相同的元素，但是 p 元素的 children 属性已经更新，以反映 likes 的新值，从 0 变为 1。接下来是 React 中称为协调的过程，其中新的虚拟 DOM 与旧的虚拟 DOM 进行比较。让我们简要讨论一下这个过程。

在计算出新的虚拟 DOM 树之后，React 执行一种称为协调的过程，以了解新树与旧树之间的差异。协调是将旧的虚拟 DOM 树与新的虚拟 DOM 树进行比较，并确定实际 DOM 的哪些部分需要更新的过程。如果您对这个过程的具体实现方式感兴趣，第四章会对此进行详细的讨论。现在，让我们考虑我们的点赞按钮。

在我们的示例中，React 将旧的虚拟 DOM 树与新的虚拟 DOM 树进行比较，并发现 p 元素已经发生了变化：具体来说，它的属性或状态或两者都已经改变。这使得 React 能够将组件标记为“脏”或“应该更新”。然后，React 计算出一组最小有效的更新操作，以便在实际 DOM 上与新虚拟 DOM 的状态进行协调，并最终更新实际 DOM，以反映对虚拟 DOM 所做的更改。

React 仅更新实际 DOM 中必要的部分，以尽量减少 DOM 操作的次数。这种方法比每次更改时更新整个 DOM 树要快得多，更高效。

虚拟 DOM 对于现代网络来说是一个强大且有影响力的发明，较新的库如 Preact 和 Inferno 在 React 中证明有效后也采用了它。我们将在第四章中更详细地介绍虚拟 DOM，但现在让我们继续下一节。

### 组件模型

- React 强烈鼓励“以组件思维思考”：即将您的应用程序拆分为较小的部分，并将它们添加到一个较大的树中以组合您的应用程序。组件模型是 React 中的一个关键概念，也是使 React 如此强大的原因。让我们谈谈为什么：它鼓励在每个地方重复使用相同的内容，这样如果出现问题，您只需在一个地方修复它，问题就会得到解决。这被称为 DRY（不要重复自己）开发，是软件工程中的一个关键概念。例如，如果我们有一个 Button 组件，我们可以在应用程序的许多地方使用它，如果我们需要更改按钮的样式，我们可以在一个地方进行更改，所有地方都会相应更改。

- 如果能够反复识别特定组件并跟踪特定组件的更新，React 就更容易跟踪组件并在幕后执行性能优化，如记忆化、批处理和其他优化。这称为键。例如，如果我们有一个 Button 组件，我们可以为其提供一个 key 属性，React 将能够随着时间的推移跟踪 Button 组件并“知道”何时更新它，或者何时跳过更新它并继续对用户界面进行最小更改。大多数组件都有隐式键，但如果需要，我们也可以显式提供它们。

- 它帮助我们分离关注点，并将逻辑放置在逻辑影响的用户界面部分附近。例如，如果我们有一个 RegisterButton 组件，我们可以将当按钮被点击时发生的事件逻辑放置在与 RegisterButton 组件相同的文件中，而不是必须在不同的文件中跳来跳去查找按钮被点击时的逻辑。RegisterButton 组件将包装一个更简单的 Button 组件，并且 RegisterButton 组件将负责处理按钮被点击时的逻辑。这称为组合。

React 的组件模型是支撑该框架流行和成功的基本概念。这种开发方式具有许多优点，包括增强的模块化、更容易的调试和更高效的代码重用。

### 不可变状态

React 的设计理念强调了一种范式，其中我们应用程序的状态被描述为一组不可变的值。每次状态更新都被视为一个新的、独立的快照和内存引用。这种不可变的状态管理方式是 React 的价值主张的核心部分，对于开发健壮、高效和可预测的用户界面有几个优势。

通过强制不可变性，React 确保 UI 组件在任何给定时间点都反映了特定的状态。当状态发生变化时，而不是直接进行变异，您返回一个代表新状态的新对象。这使得跟踪变化、调试和理解应用程序的行为变得更容易。由于状态转换是离散的，彼此不干扰，因此由共享的可变状态引起的微妙错误的几率大大降低。

在接下来的章节中，我们将探讨 React 如何批处理状态更新并异步处理它们以优化性能。由于状态必须被视为不可变的，因此可以安全地聚合和应用这些“事务”，而不会出现一次更新破坏另一个更新的状态的风险。这导致了更可预测的状态管理，并且可以改善应用程序的性能，特别是在复杂的状态转换期间。

不可变状态的使用进一步强化了软件开发中的最佳实践。它鼓励开发人员在数据流方面采用函数式思维，减少副作用，并使代码更易于理解。不可变数据流的清晰性简化了理解应用程序如何工作的心智模型。

不可变性还可以实现强大的开发工具，例如使用 Replay.io 等工具进行时间旅行调试，开发人员可以向前和向后浏览应用程序状态变化，以检查任意时间点的 UI。只有将每个状态更新保留为唯一且未修改的快照，这才是可行的。

React 对不可变状态更新的承诺是一个经过深思熟虑的设计选择，带来了许多好处。它符合现代函数式编程原则，可以实现高效的 UI 更新，优化性能，降低错误的可能性，并改善整体开发人员体验。这种状态管理方式支撑了 React 的许多高级功能，并将继续是 React 发展的基石。

## 发布 React

单向数据流是对多年来构建 Web 应用程序的方式的一个激进转变，它受到了怀疑。事实上，Facebook 是一家拥有大量资源、大量用户和大量工程师观点的大公司，这使得它的上升之路非常陡峭。经过深入审查，React 在内部取得了成功。它被 Facebook 和 Instagram 采用。

然后在 2013 年开源，面向全世界发布，但遭到了巨大的反对。人们严厉批评 React 使用 JSX，指责 Facebook “将 HTML 放入 JavaScript” 并破坏了关注点的分离。Facebook 成为了一个“重新思考最佳实践”并破坏网络的公司。

最终，在 Netflix、Airbnb 和纽约时报等公司缓慢而稳定地采用之后，React 成为了在 Web 上构建用户界面的事实标准。

这个故事中有很多细节被省略了，因为它们超出了本书的范围，但在我们深入细节之前了解 React 的背景是很重要的，特别是 React 被创建来解决的技术问题的范围。如果你对 React 的故事更感兴趣，YouTube 上有一部完整的 React 历史纪录片，名为 Honeypot 制作的《React.js：纪录片》。

考虑到 Facebook 在巨大规模下面临的这些问题，React 开创了一种基于组件的方法来构建用户界面，可以解决这些问题和更多问题，其中每个组件都是可以重用和组合的代码的独立单元，用于构建更复杂的用户界面。React 发布一年后，Facebook 发布了 Flux：一种管理 React 应用程序中数据流的模式。Flux 是对管理大规模应用程序中数据流挑战的应对，它是 React 生态系统的重要组成部分。让我们来看一下 Flux 以及它如何与 React 结合。

## 总结：那么...为什么 React 如此受欢迎？

React 之所以如此受欢迎，是因为它使开发人员能够以更高的可预测性和可靠性构建用户界面，让我们以声明式的方式表达我们想要在屏幕上看到的内容，而 React 则通过以高效的方式对 DOM 进行增量更新来处理具体的实现。它还鼓励我们以组件为中心思考，这有助于我们分离关注点并更轻松地重用代码。它在 Meta 公司经过了大规模测试，并设计用于大规模应用。此外，它是开源的，并且可以免费使用。

React 还拥有庞大而活跃的生态系统，开发人员可以获得各种各样的工具、库和资源。这个生态系统包括用于测试、调试和优化 React 应用程序的工具，以及用于常见任务（如数据管理、路由和状态管理）的库。此外，React 社区非常活跃和支持，有许多在线资源、论坛和社区可供开发人员学习和成长。

React 是平台无关的，这意味着它可以用于构建广泛的平台上的 Web 应用程序，包括桌面、移动和虚拟现实。这种灵活性使得 React 成为开发人员的理想选择，因为它可以让他们使用单一的代码库构建跨多个设备运行的应用程序。

总之，React 的价值主张围绕着其基于组件的架构、声明式编程模型、虚拟 DOM、JSX、丰富的生态系统、平台无关的特性以及由 Meta 公司支持。这些特性使得 React 成为需要构建快速、可扩展和易于维护的 Web 应用程序的开发人员的理想选择。无论您是构建简单的网站还是复杂的企业应用程序，React 都可以帮助您以比许多其他技术更高效、更有效的方式实现您的目标。让我们进行回顾。

# 第2章 JSX  
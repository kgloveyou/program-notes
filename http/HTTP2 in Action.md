# HTTP/2 in Action

​		HTTPS 由浏览器处理，因此开发者工具只显示加密之前的HTTP请求和解密之后的响应。大多数情况下，在设置完成后HTTPS可以被忽略，因为我们有合适的工具来处理加/解密。



​		大多数浏览器可以为每个域名打开6个连接。为了进一步突破6个连接的限制，许多网站从子域（例如，`static.example.com`  ）提供静态资源，如图像、CSS和JavaScript，Web浏览器从而可以为每个新域名打开另外6个连接。这种技术称为`域名分片`。

​		**TCP三次握手的过程：**

1、客户端发送一个同步 (SYN) 消息，并附上首个序列号，告诉服务器，后续自此请求的所有 TCP 数据包都基于该序列号。

2、服务器向客户端确认收到发来的序列号（ACK），并发送一个服务器同步同步消息（SYN），告诉客户端它要使用的序列号。 两个消息组合成一个 SYN-ACK 消息。

3、最后，客户端确认收到服务器的序列号，发送一个 ACK 消息。



## 2.5 从HTTP/1.1 到HTTP/2  

### 2.5.1 SPDY  

SPDY (发音同“speedy”，不是一个缩写)  协议。



### 2.5.2 HTTP/2  

基于SPDY，HTTP/2 是SPDY的标准化版本。

# 3	升级到HTTP/2

https://caniuse.com/http2

HTTP/2 is only supported over TLS (HTTPS). 

### 3.1.2 服务器对 HTTP/2的支持

大多数Web服务器使用单独的库（通常是OpenSSL  ，也有一些变体，如LibreSSL 和BoringSSL  ）来处理SSL/TLS  。

# 4、HTTP/2 协议基础

新增了如下概念：

- 二进制协议

- 多路复用

- 流量控制功能

- 数据流优先

- 首部压缩

- 服务端推送

### 4.1.1 使用二进制格式替换文本格式

### 4.1.2 多路复用代替同步请求

​		HTTP/2允许在单个连接连接上同时执行多个请求，每个HTTP请求或相应使用不同的流。通过使用二进制分帧层，给每个帧分配一个流标识符，以支持同时发出多个独立请求。当接收到该流的所有帧时，接收方可以将帧组合成完整消息。

​		帧时同时发送多个消息的关键。每个帧都有标签标明它属于哪个消息（流），这样在一个连接上就可以同时有两个、三个甚至上百个消息。

### 4.1.3 流的优先级和流量控制

​		流的优先级控制是通过这种方式实现的：当数据帧在排队时，服务器会给高优先级的请求发送更多的帧。

​		流量控制是在同一连接上使用多个流的另一种方式。如果接收方处理消息的速度慢于发送方，就会存在积压，需要将数据放入缓冲区。而当缓冲区满时会导致丢包，需要重新发送。在连接层，TCP支持限流，但HTTP/2要在流的层面实现流量控制。

### 4.1.4 首部压缩

​		HTTP首部（包括请求首部和响应首部）用于发送与请求和响应相关的额外信息。在这些首部中，有很多信息是重复的，多个资源使用的首部经常相同。请看如下首部，它们会随着每个请求被发送，通常和之前的请求使用相同的值：

- Cookie  
- User-Agent  
- Host  
- Accept  
- Accept-Encoding  

​		响应首部可能是有重复，会很浪费资源。有些特殊的响应首部，如CSP（Content Security Policy  ）首部，可能会很大，也可能会有重复。

​		HTTP/1允许压缩HTTP正文内容（如Accept-Encoding  首部），但是不会压缩HTTP首部。HTTP/2引入首部压缩的概念，但是它使用了和正文压缩不同的技术。该技术支持跨请求压缩首部，这可以避免正文压缩锁使用的算法的安全问题。

### 4.1.5	服务端推送

​		HTTP/1和HTTP/2之间的另外一个重要不同是，HTTP/2添加了**服务端推送**的概念，它允许服务端给一个请求返回多个响应。在HTTP/1下，当主页加载完成时，在渲染之前，浏览器需要解析它并请求其他的资源（如CSS和JavaScript）。有了HTTP/2服务单推送，那些资源可以与首个请求的响应一起被返回，当浏览器想使用的时候，它们应该是可用的。

​		HTTP/2服务端推送是HTTP协议中的新概念，如果使用不当，它很容易浪费带宽。

## 4.2 如何创建一个HTTP/2连接

### 4.2.1 使用HTTPS协商

**HTTPS握手**

​		使用HTTPS意味着使用SSL/TLS来加密一个标准的HTTP/1连接或者HTTP/2连接。

​		公钥秘钥加密被称为**非对称加密**，因为它加密和解密消息时使用不同的密钥。这种类型的加密，在你连接到一个新的服务器时非常有必要，但它速度慢，所以这种加密方式用于协商一个对称加密的密钥，以便在创建连接之后使用对称密钥加密消息。协商发生在连接开始时的TLS握手过程中。

。。。

​		在所有这些步骤之后，HTTPS 会话就建立起来，并且所有未来的通信都使用商定的密钥进行保护。 在你发送单个请求之前，此设置至少添加了两次往返。 传统上认为 HTTPS 会慢，但是尽管计算机性能的提升使得消息的加密和解密并不明显，但初始连接延迟是显而易见的，如第 2 章中的瀑布图所示。完成此初始 HTTPS 设置后，未来的 HTTP 消息 在同一个连接上不需要经过这个协商。

## 4.3 HTTP/2帧

### 4.3.1 查看HTTP/2帧

**使用CHROME NET-EXPORT**  

在chrome浏览器中输入：

```
chrome://net-export/  
```



p130